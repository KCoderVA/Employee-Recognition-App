# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
App:
  Properties:
    BackEnabled: =false
    OnStart: "=/////////////////////////////\n// DEVELOPER NOTES:\n/////////////////////////////\n// // // The \"App.StartScreen\" for this application is this \"Loading_Screen\", and for app performance issues the \"App.OnStart\" and \"Loading_Screen.OnVisible\" properties have minimal functions or calculations added to it. Similarly, each of the other screens within this app have optimized \"OnVisible\" properties to improve user interface and app performance as much as possible.\n// // // The vast majority of the app's variables, collections, objects, forms, and settings are configured to be initialized, established, cleared, or reset on this within the \"Loading_Variable_Timer\" object contained within this screen. Many of the objects, buttons, functions, or formula within the app will redirect user navigation back to this \"Loading_Screen\" at designated points with the intention to trigger re-initialization of the app configuration and content to planned state.\n/////////////////////////////\n// THIS APPLICATION'S CURRENT PUBLISHED VERSION URL:  \"https://apps.gov.powerapps.us/play/e/default-e95f1b23-abaf-45ee-821d-b7ab251ab3bf/a/f14182d6-e4ef-42bf-8dd2-0a628377cb77\"\n// Part of URL         | URL's Value                                              | What it Represents\n// --------------------|----------------------------------------------------------|-------------------------------\n// Base URL            | https://apps.gov.powerapps.us/                           | Power Apps US Gov Cloud\n// Environment         | e/default-e95f1b23-abaf-45ee-821d-b7ab251ab3bf           | \"e/\" indicates Environment name and GUID\n// App                 | a/f14182d6-e4ef-42bf-8dd2-0a628377cb77                   | \"a/\" indicates App ID (GUID)\n// tenantId            | e95f1b23-abaf-45ee-821d-b7ab251ab3bf                     | Azure ActiveDirectory Tenant ID for access/user authentication (may be omitted for VA tenants)\n// hint                | 361aa4ec-99b2-4d29-b485-8f905db4f09b                     | Used internally by PowerApps for navigation, session context, or deeplinks (may be omitted)\n// sourcetime          | 1750776424383                                            | Timestamp/session identifier for session or cache-busting (may be omitted)\n/////////////////////////////\n\n\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL IDENTIFY THE CURRENT USER BY Windows ActiveDirectory EMAIL ADDRESS, USED TO GENERATE NEARLY ALL OTHER USER AND AUTHORIZATION PARAMETERS OR VARIABLES\n    Set(\n        gbl_userCurrentEmail,\n        Lower(User().Email)\n    );\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL PICK UP ADDITIONAL Windows ActiveDirectory DEMOGRAPHICS BASED ON THE EMAIL ADDRESS IDENTIFIED IN \"gbl_userCurrentEmail\"\n    Set(\n        gbl_userCurrentProfile,\n        Office365Users.SearchUser({searchTerm:(gbl_userCurrentEmail)})\n    );\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL PICK UP ADDITIONAL Windows ActiveDirectory DEMOGRAPHICS BASED ON THE APPLICATION'S ACCESS PERMISSIONS, CONTAINED WITHIN THE RESPECTIVE SharePoint LISTS:\n    Set(\n        gbl_userIsTriage,\n        !IsEmpty(\n            Filter(\n                App_Users_TriageTeam,\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        )\n    );\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL SET A VARIABLE TO DETERMINE SPECIAL ACCESS FOR APP ADMINISTRATORS TO IMPACT OBJECTS, CONTROLS, VIEWS, FORMULA, OR FUNCTIONS ONLY WHEN THE CURRENT USER IS IDENTIFIED AS AN APP ADMINISTRATOR (VIA THE USER BEING ADDED OR REMOVED FROM THIS SharePoint LIST: \"https://dvagov.sharepoint.com/sites/vhahin/svc/ci/TelehealthTeamApp/Lists/DeskAdmins/AllItems.aspx\"). NOTE: THIS \"gbl_userIsAdmin\" VARIABLE ONLY IMPACTS THE INTERNAL APP COMPONENTS, WHILE BEING ADDED TO THE SHAREPOINT LIST DOES NOT GRANT A USER OFFICIAL \"Power Apps Ownership\" PERMISSIONS TO PROGRAM OR DEVELOP THIS APP\n    Set(\n        gbl_userIsAdmin,\n        !IsEmpty(\n            Filter(\n                App_Users_Admins,//SharePoint List URL:  https://dvagov.sharepoint.com/sites/HinesEmployeeEngagementandWholeHealth/EmployeeRecognitionApp/Lists/App_Users_Admins/\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        ) || (\"kyle.coder@va.gov\" = Lower(Text(gbl_userCurrentEmail)))\n    );\n    Set(\n        gbl_userIsTriageTeam,\n        !IsEmpty(\n            Filter(\n                App_Users_TriageTeam,//SharePoint List URL:  https://dvagov.sharepoint.com/sites/HinesEmployeeEngagementandWholeHealth/EmployeeRecognitionApp/Lists/App_Users_TriageTeam/\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        )\n    );\n    Set(\n        gbl_userIsHROTeam,\n        !IsEmpty(\n            Filter(\n                App_Users_HROTeam,//SharePoint List URL:  https://dvagov.sharepoint.com/sites/HinesEmployeeEngagementandWholeHealth/EmployeeRecognitionApp/Lists/App_Users_HROTeam/\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        )\n    );\n    Set(\n        gbl_userIsNursingTeam,\n        !IsEmpty(\n            Filter(\n                App_Users_NursingTeam,//SharePoint List URL:  https://dvagov.sharepoint.com/sites/HinesEmployeeEngagementandWholeHealth/EmployeeRecognitionApp/Lists/App_Users_NursingTeam/\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        )\n    );\n    Set(\n        gbl_userIsPublicAffairsTeam,\n        !IsEmpty(\n            Filter(\n                App_Users_PublicAffairsTeam,//SharePoint List URL:  https://dvagov.sharepoint.com/sites/HinesEmployeeEngagementandWholeHealth/EmployeeRecognitionApp/Lists/App_Users_PublicAffairsTeam/\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        )\n    );\n    Set(\n        gbl_userIsStarfishTeam,\n        !IsEmpty(\n            Filter(\n                App_Users_StarfishTeam,//SharePoint List URL:  https://dvagov.sharepoint.com/sites/HinesEmployeeEngagementandWholeHealth/EmployeeRecognitionApp/Lists/App_Users_StarfishTeam/\n                (Lower(Email_Text) = Lower(Text(gbl_userCurrentEmail)))\n            )\n        )\n    );\n\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL SET A VARIABLE TO ALLOW CERTAIN FUNCTIONS ONLY ON THE FIRST TIME THE APPLICATION LOADS, AND TURNED OFF ON RE-NAVIGATIONS\n    Set(\n        gbl_appFirstOnStart,\n        true\n    );\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL SET A VARIABLE TO DETECT THE HOST OPERATING SYSTEM (\"Windows\" or \"Mobile\"), USED TO ALTER FUTURE DEEPLINKS AND USER INTERFACE LAYOUTS\nIf(\n    Host.OSType = \"Windows\",\n        //Set(gbl_HostIsWindows, true);\n        //Set(gbl_HostIsMobile, false);\n        //Set(gbl_screenWidthValue, 1366);\n        //Set(gbl_screenHeightValue, 768),\n        Set(gbl_HostIsMobile, true);\n        Set(gbl_HostIsWindows, false);\n        Set(gbl_screenWidthValue, 640);\n        Set(gbl_screenHeightValue, 1136)\n);\n/*\n    If(Host.OSType = \"Windows\",\n        Set(gbl_HostIsWindows, true)\n            && Set(gbl_HostIsMobile, false)\n            && Update(App.Width, Value(App.Width), 1200),\n        Set(gbl_HostIsMobile, true)\n            && Set(gbl_HostIsWindows, false)\n            && Update(App.Width, Value(App.Width), 1200)\n            //&& Param(\"hostClientType\") = \"web\"\n    );\n*/\n\n// WHEN THIS \"App.OnStart\" FUNCTION IS CALLED, THIS CODE BLOCK WILL INITIALIZE AND SET A COMBINATION OF COLLECTIONS & VARIABLE TO DETECT THE CURRENT APPLICATION VERSION HISTORY (via \"PowerAppsForMakers\" connector) AND ALLOW IN-APP DISPLAY OF PUBLICATION DATE AND PUBLICATION VERSION NUMBER\n    ClearCollect(\n        col_appVersionNumbers,\n        PowerAppsforMakers.GetAppVersions(\"f14182d6-e4ef-42bf-8dd2-0a628377cb77\",{'$top':(\"99\")})\n    );\n    ClearCollect(\n        col_appVersionsUngrouped,\n        Ungroup(\n            col_appVersionNumbers,\n            value\n        )\n    );\n    Set(\n        gbl_appVersionNumber,\n        Concatenate(\n            \"1.1.\",\n            \"1\"\n            //,\"-\", CountRows(col_appVersionsUngrouped)\n            )\n    );\n    Set(\n        gbl_appVersionDateTime,\n        LookUp(\n            Ungroup(\n                col_appVersionNumbers,\n                value\n            ),\n            properties.lifeCycleId = \"Published\"\n        ).properties.appVersion\n    );\n    //Clear(col_appVersionNumbers);\n    //Clear(col_appVersionsUngrouped);\n////////////\n/*\n    Set(\n        z_version_Properties_LifecycleID_Published,\n        LookUp(\n            Ungroup(\n                col_appVersionNumbers,\n                value\n            ),\n            properties.lifeCycleId = \"Published\"\n        ).properties.appVersion\n    );\n    Set(\n        z_version_Properties_LifecycleID_Saved,\n        LookUp(\n            Ungroup(\n                col_appVersionNumbers,\n                value\n            ),\n            properties.lifeCycleId = \"Autosaved\"\n        ).properties.appVersion\n    );\n    Set(\n        z_version_Tags_SienaVersion_Published,\n        LookUp(\n            Ungroup(\n                col_appVersionNumbers,\n                value\n            ),\n            properties.lifeCycleId = \"Published\"\n        ).tags.sienaVersion\n    );\n    Set(\n        z_version_Tags_SienaVersion_Saved,\n        LookUp(\n            Ungroup(\n                col_appVersionNumbers,\n                value\n            ),\n            properties.lifeCycleId = \"Autosaved\"\n        ).tags.sienaVersion\n    );\n    Set(\n        z_versions_Tags_SienaVersionDTVzulu_PublishedLower,\n        Left(\n            z_version_Tags_SienaVersion_Published, 15)\n            //Find(\"-\", z_version_Tags_SienaVersion_Published) - 2)\n    );\n    Set(\n        z_versions_Tags_SienaVersionDTVzulu_PublishedYear,\n        Left(z_versions_Tags_SienaVersionDTVzulu_PublishedLower, 4)\n    );\n    /*Set(\n        z_versions_Tags_SienaVersionDTVlocal_Published_Converted,\n        DateTimeValue(\n            Mid(z_versions_Tags_SienaVersionDTVzulu_Published,1,4) & \"-\" & \n            Mid(z_versions_Tags_SienaVersionDTVzulu_Published,5,2) & \"-\" & \n            Mid(z_versions_Tags_SienaVersionDTVzulu_Published,7,2) & \" \" & \n            Mid(z_versions_Tags_SienaVersionDTVzulu_Published,10,2) & \":\" & \n            Mid(z_versions_Tags_SienaVersionDTVzulu_Published,12,2) & \":\" & \n            Mid(z_versions_Tags_SienaVersionDTVzulu_Published,14,2),\n            \"en-US\"\n        )\n    );\n    Set(\n        z_versions_Tags_SienaVersionDTVlocal_Published_SubsituteT,\n        Substitute(z_versions_Tags_SienaVersionDTVzulu_Published, \"T\", \" \")\n    );\n    Set(\n        z_versions_Tags_SienaVersionDTVlocal_Published_SubsituteZ,\n        Substitute(z_versions_Tags_SienaVersionDTVzulu_Published, \"Z\", \"\")\n    );\n*/\n\n\n\n\n\n\n\n/*\n// Get date/time stamp of last published version\n    Set(ZZZ_appVersionDateTime_Published,\n        LookUp(\n            Ungroup(col_appVersionNumbers,value),\n            properties.lifeCycleId = \"Published\").properties.appVersion\n    );\n// Get date/time stamp of last autosaved version\n    Set(ZZZ_appVersionDateTime_Autosaved,\n        LookUp(\n            Ungroup(col_appVersionNumbers,value),\n            properties.lifeCycleId = \"Autosaved\").properties.appVersion\n    );\n// Get date/time stamp of last drafted version\n    Set(ZZZ_appVersionDateTime_Draft,\n        LookUp(\n            Ungroup(col_appVersionNumbers,value),\n            properties.lifeCycleId = \"Draft\").properties.appVersion\n    );\n// Get date/time stamp of last unpublished version\n    Set(ZZZ_appVersionDateTime_NotBlank,\n        LookUp(\n            Ungroup(col_appVersionNumbers,value),\n            properties.lifeCycleId <> \"Published\").properties.appVersion\n    );\nSet(\n    ZZZ_varLatestDraftVersion,\n    First(\n        SortByColumns(\n            Filter(\n                Ungroup(col_appVersionNumbers, value),\n                properties.lifeCycleId = \"Draft\"\n            ),\"type\",SortOrder.Descending)\n        )\n);\n\n\n\n    \n// Get date/time stamp of last unpublished version\n    Set(ZZZ_appVersionDateTime_Distinct,\n        Distinct(\n            Ungroup(col_appVersionNumbers, value),\n            properties.lifeCycleId\n        )\n    );\n\n\n    // === Flatten the nested 'value' table once for reuse ===\nClearCollect(\n    col_AppVersionsFlat,\n    Ungroup(col_appVersionNumbers, value)\n);\n\n// === Get appVersion of last Published ===\nSet(\n    ZZZ_appVersionDateTime_Published222,\n    LookUp(\n        col_AppVersionsFlat,\n        properties.lifeCycleId = \"Published\"\n    ).properties.appVersion\n);\n\n// === Get appVersion of last Autosaved ===\nSet(\n    ZZZ_appVersionDateTime_Autosaved222,\n    LookUp(\n        col_AppVersionsFlat,\n        properties.lifeCycleId = \"Autosaved\"\n    ).properties.appVersion\n);\n\n// === Get appVersion of last Draft ===\nSet(\n    ZZZ_appVersionDateTime_Draft222,\n    LookUp(\n        col_AppVersionsFlat,\n        properties.lifeCycleId = \"Draft\"\n    ).properties.appVersion\n);\n\n// === Get appVersion of last Unpublished (anything not 'Published') ===\nSet(\n    ZZZ_appVersionDateTime_NotPublished222,\n    LookUp(\n        col_AppVersionsFlat,\n        properties.lifeCycleId <> \"Published\"\n    ).properties.appVersion\n);\n\n// === Get latest Draft record as a full record object ===\nSet(\n    ZZZ_varLatestDraftVersion222,\n    First(\n        SortByColumns(\n            Filter(\n                col_AppVersionsFlat,\n                properties.lifeCycleId = \"Draft\"\n            ),\n            \"type\",\n            SortOrder.Descending\n        )\n    )\n);\n\n// === Distinct list of all lifeCycleId values found ===\nSet(\n    ZZZ_appVersionDateTime_Distinct222,\n    Distinct(\n        col_AppVersionsFlat,\n        properties.lifeCycleId\n    )\n);\n// === Get appVersion of last published SeinnaVersion ===\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionDistinct,\n    Distinct(\n        col_AppVersionsFlat,\n        tags.sienaVersion\n    )\n);\n\n\n\nIf(\n    ZZZ_appVersionDateTime_Published222 <> ZZZ_appVersionDateTime_NotPublished222,\n    Set(\n        ZZZ_UserOutOfDate,\n        true),\n    Set(\n        ZZZ_UserOutOfDate,\n        false)\n);\n\n// === Get appVersion of last published SeinnaVersion ===\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionPublished22222,\n    First(\n        Filter(col_AppVersionsFlat,\n            tags.sienaVersion\n            )\n            \n            //LookUp(\n            //    col_AppVersionsFlat,\n            //    StartsWith(tags.sienaVersion, \"2025\"),\n            //    tags.sienaVersion)\n    )\n);\nFirst(\n        SortByColumns(\n            Filter(\n                col_AppVersionsFlat,\n                properties.lifeCycleId = \"Published\"\n            ),\n            \"type\",\n            SortOrder.Descending\n        )\n    );\n\n\n\n// === Get appVersion of last published SeinnaVersion ===\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionUnpublished,\n    LookUp(\n        col_AppVersionsFlat,\n        tags.sienaVersion <> \"Published\"\n    ).tags.sienaVersion\n);\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionPublishedLeft,\n    Left(\n        ZZZ_appVersionDateTime_SiennaVersionPublished,\n        Find(\"-\", ZZZ_appVersionDateTime_SiennaVersionPublished) - 1)\n);\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionPublishedDTV,\n    DateTimeValue(\n        Substitute(\n            Substitute(ZZZ_appVersionDateTime_SiennaVersionPublished, \"T\", \" \"),\n            \"Z\", \"\"),\n        \"en-US\"\n    )\n);\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionUnPublishedLeft,\n    Left(\n        ZZZ_appVersionDateTime_SiennaVersionUnpublished,\n        Find(\"-\", ZZZ_appVersionDateTime_SiennaVersionUnpublished) - 1)\n);\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionUnpublishedDTV,\n    DateTimeValue(\n        Substitute(\n            Substitute(ZZZ_appVersionDateTime_SiennaVersionUnpublished, \"T\", \" \"),\n            \"Z\", \"\"),\n        \"en-US\"\n    )\n);\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionGreaterThan,\n    If(\n        (ZZZ_appVersionDateTime_SiennaVersionPublishedDTV > ZZZ_appVersionDateTime_SiennaVersionUnpublishedDTV),\n            ZZZ_appVersionDateTime_SiennaVersionPublishedDTV,\n            ZZZ_appVersionDateTime_SiennaVersionUnpublishedDTV\n    )\n);\nSet(\n    ZZZ_appVersionDateTime_SiennaVersionOutOfDate,\n    If(\n        (ZZZ_appVersionDateTime_SiennaVersionPublishedDTV > ZZZ_appVersionDateTime_SiennaVersionUnpublishedDTV),\n            false,\n            true\n    )\n);\n*/"
    SizeBreakpoints: =[640, 1200, 1800, 2400]
    StartScreen: =Loading_Screen
    Theme: =PowerAppsTheme
